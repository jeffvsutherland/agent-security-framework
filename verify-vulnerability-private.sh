#!/bin/bash
# Private Verification Script - DO NOT SHARE PUBLICLY
# Purpose: Verify Clawdbot default skills vulnerability

echo "=== Clawdbot Vulnerability Verification Script ==="
echo "This script checks for credential exposure in default skills"
echo ""

# Check if Clawdbot is installed
CLAWDBOT_PATH="/opt/homebrew/lib/node_modules/clawdbot/skills"
if [ ! -d "$CLAWDBOT_PATH" ]; then
    echo "❌ Clawdbot skills not found at expected path"
    echo "   Please update CLAWDBOT_PATH variable"
    exit 1
fi

echo "✅ Found Clawdbot skills directory"
echo ""

# Check oracle skill
echo "1. Checking oracle skill for environment variable usage..."
if [ -f "$CLAWDBOT_PATH/oracle/SKILL.md" ]; then
    if grep -q "OPENAI_API_KEY.*auto" "$CLAWDBOT_PATH/oracle/SKILL.md"; then
        echo "   ⚠️  VULNERABLE: oracle auto-reads OPENAI_API_KEY from environment"
    else
        echo "   ✅ oracle skill appears safe"
    fi
else
    echo "   ⚠️  oracle skill not found"
fi

# Check openai-image-gen
echo ""
echo "2. Checking openai-image-gen skill..."
if [ -f "$CLAWDBOT_PATH/openai-image-gen/scripts/gen.py" ]; then
    LINE=$(grep -n "os.environ.get.*OPENAI_API_KEY" "$CLAWDBOT_PATH/openai-image-gen/scripts/gen.py" | head -1)
    if [ ! -z "$LINE" ]; then
        echo "   ⚠️  VULNERABLE: openai-image-gen reads API key from environment"
        echo "   Found at: $LINE"
    else
        echo "   ✅ openai-image-gen appears safe"
    fi
else
    echo "   ⚠️  openai-image-gen skill not found"
fi

echo ""
echo "=== Verification Complete ==="
echo ""
echo "If vulnerabilities were found:"
echo "1. Do NOT post this publicly"
echo "2. Report privately to Clawdbot team"
echo "3. Use responsible disclosure timeline"
echo ""
echo "For questions about this verification: [redacted]"